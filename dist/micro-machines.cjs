"use strict";var l=Object.defineProperty;var d=(a,t,e)=>t in a?l(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var i=(a,t,e)=>d(a,typeof t!="symbol"?t+"":t,e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class o{constructor(t,e){i(this,"name");i(this,"onEnter");this.name=t,this.onEnter=e}async emitOnEnter(t){this.onEnter!==void 0&&await this.onEnter(t)}get isTerminal(){return this.onEnter===void 0}}class c{constructor({initial:t,final:e,context:n}){i(this,"context");i(this,"states");i(this,"initial");i(this,"final");i(this,"currentState");i(this,"onStateChangedCallback");i(this,"onTerminatedCallback");i(this,"history");this.initial=t,this.final=e,this.context=n,this.states=[],this.history=[]}addState(t){this.states.push(t)}async start(t){await this.transition(this.initial,t)}async transition(t,e){var s;const n=this.getState(t);if(n.name===((s=this.currentState)==null?void 0:s.name))throw new Error(`Already in ${t}`);this.history.push(t),e!==void 0&&(this.context={...this.context,...e}),this.currentState=n,this.onStateChangedCallback!==void 0&&this.onStateChangedCallback({state:t,context:this.context}),this.currentState.isTerminal?this.onTerminatedCallback!==void 0&&this.onTerminatedCallback({state:this.currentState.name,context:this.context}):await this.currentState.emitOnEnter(this.context)}onStateChanged(t){this.onStateChangedCallback=t}getState(t){const e=this.states.find(n=>n.name===t);if(e===void 0)throw new Error(`Invalid state: ${t}`);return e}onTerminated(t){this.onTerminatedCallback=t}get success(){return this.currentState===void 0?!1:this.final.includes(this.currentState.name)}get terminated(){var t;return((t=this.currentState)==null?void 0:t.isTerminal)===!0}clearListeners(){this.onStateChangedCallback=void 0,this.onTerminatedCallback=void 0}}const u=a=>{const e=a(async(s,r)=>{await n.transition(s,r)}),n=new c({initial:e.initial,final:Array.isArray(e.final)?e.final:[e.final],context:e.context});return Object.entries(e.states).forEach(([s,r])=>{const h=new o(s,r);n.addState(h)}),n};exports.State=o;exports.StateMachine=c;exports.createMachine=u;
